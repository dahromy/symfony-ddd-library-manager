{% extends 'base.html.twig' %}

{% block title %}Books{% endblock %}

{% block body %}
    <h1 class="text-3xl font-bold mb-4">Books</h1>

    {% for message in app.flashes('success') %}
        <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4" role="alert">
            {{ message }}
        </div>
    {% endfor %}

    <a href="{{ path('create_book') }}" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mb-4 inline-block">Create New Book</a>

    <table class="min-w-full bg-white">
        <thead>
            <tr>
                <th class="py-2 px-4 border-b">Title</th>
                <th class="py-2 px-4 border-b">ISBN</th>
                <th class="py-2 px-4 border-b">Author ID</th>
                <th class="py-2 px-4 border-b">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for book in books %}
                <tr>
                    <td class="py-2 px-4 border-b">{{ book.title }}</td>
                    <td class="py-2 px-4 border-b">{{ book.isbn }}</td>
                    <td class="py-2 px-4 border-b">{{ book.author.id }}</td>
                    <td class="py-2 px-4 border-b">
                        <a href="{{ path('get_book', {'id': book.id}) }}" class="text-blue-500 hover:text-blue-700">View</a>
                        <a href="{{ path('update_book', {'id': book.id}) }}" class="text-green-500 hover:text-green-700 ml-2">Edit</a>
                        <button onclick="deleteBook({{ book.id }})" class="text-red-500 hover:text-red-700 ml-2">Delete</button>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        function deleteBook(id) {
            if (confirm('Are you sure you want to delete this book?')) {
                fetch(`/books/${id}`, { method: 'DELETE' })
                    .then(response => response.json())
                    .then(data => {
                        alert(data.message);
                        location.reload();
                    })
                    .catch(error => console.error('Error:', error));
            }
        }
    </script>
{% endblock %}
